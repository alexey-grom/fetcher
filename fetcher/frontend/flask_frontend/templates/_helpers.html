{% macro render_form(form, submit, action, extra=None) -%}
    <form method="POST" action="{{ action }}" class="form-horizontal"{% if form.has_file_field %} enctype="multipart/form-data"{% endif %}>
    <fieldset>
        {{ form.hidden_tag() }}

        {% for f in form if f.name != 'csrf_token' and f.name != 'csrf' %}
        <div class="control-group{% if f.errors %} error{% endif %}">
            {{ f.label(class='control-label') }}
            <div class="controls">
                <div>
                    {% if not focus_set %}
                    {{ f(autofocus='autofocus') }}
                    {% set focus_set = True %}
                    {% else %}
                    {{ f() }}
                    {% endif %}
                </div>
                {% if f.errors %}
                <ul>
                    {% for e in f.errors %}
                    <li>{{ e }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        <div class="control-group">
            <div class="controls">
                <input type="submit" class="btn btn-primary btn-large" value="{{ submit }}" />
            </div>
        </div>
    </fieldset>
    </form>
{% endmacro %}